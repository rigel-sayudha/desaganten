<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter dan Pagination Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-blue-600 mb-8">Test Filter & Pagination Admin Surat</h1>
        
        <!-- Filter Controls -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">Filter & Pagination Controls</h2>
            <div class="flex gap-4 items-center">
                <div>
                    <label for="jenisFilter" class="block text-sm font-medium mb-2">Filter Jenis Surat:</label>
                    <select id="jenisFilter" class="border rounded px-3 py-2 w-48">
                        <option value="">-- Semua Jenis --</option>
                        <option value="domisili">Domisili</option>
                        <option value="ktp">KTP</option>
                        <option value="kk">KK</option>
                        <option value="skck">SKCK</option>
                        <option value="belum_menikah">Belum Menikah</option>
                        <option value="tidak_mampu">Tidak Mampu</option>
                    </select>
                </div>
                <div>
                    <label for="perPageSelect" class="block text-sm font-medium mb-2">Per Page:</label>
                    <select id="perPageSelect" class="border rounded px-3 py-2">
                        <option value="5">5</option>
                        <option value="10" selected>10</option>
                        <option value="20">20</option>
                    </select>
                </div>
                <div class="text-sm text-gray-600">
                    <span id="totalInfo">Total: 0 item</span>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <table class="min-w-full">
                <thead class="bg-blue-600 text-white">
                    <tr>
                        <th class="px-4 py-3 text-left">No</th>
                        <th class="px-4 py-3 text-left">Nama</th>
                        <th class="px-4 py-3 text-left">Jenis Surat</th>
                        <th class="px-4 py-3 text-left">Status</th>
                        <th class="px-4 py-3 text-left">Tanggal</th>
                    </tr>
                </thead>
                <tbody id="dataTable" class="divide-y divide-gray-200">
                    <!-- Data akan diisi oleh JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="bg-white px-4 py-3 flex items-center justify-between border-t mt-6 rounded-lg">
            <div>
                <span id="showingInfo" class="text-sm text-gray-700">
                    Menampilkan 0 - 0 dari 0 hasil
                </span>
            </div>
            <div class="flex gap-2">
                <button id="prevBtn" class="px-3 py-1 border rounded hover:bg-gray-50 disabled:opacity-50">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div id="pageNumbers" class="flex gap-1">
                    <!-- Page numbers akan diisi JavaScript -->
                </div>
                <button id="nextBtn" class="px-3 py-1 border rounded hover:bg-gray-50 disabled:opacity-50">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- Test Results -->
        <div class="bg-white p-6 rounded-lg shadow-md mt-6">
            <h2 class="text-xl font-semibold mb-4">Test Results</h2>
            <div id="testResults" class="space-y-2 text-sm">
                <!-- Test results akan ditampilkan di sini -->
            </div>
        </div>
    </div>

    <script>
        // Sample data untuk testing
        const sampleData = [
            { id: 1, nama: 'Ahmad Santoso', jenis: 'domisili', status: 'menunggu', tanggal: '2025-01-01' },
            { id: 2, nama: 'Budi Wijaya', jenis: 'ktp', status: 'diproses', tanggal: '2025-01-02' },
            { id: 3, nama: 'Citra Dewi', jenis: 'domisili', status: 'sudah diverifikasi', tanggal: '2025-01-03' },
            { id: 4, nama: 'Dian Pratama', jenis: 'skck', status: 'menunggu', tanggal: '2025-01-04' },
            { id: 5, nama: 'Eka Saputra', jenis: 'kk', status: 'diproses', tanggal: '2025-01-05' },
            { id: 6, nama: 'Farah Amelia', jenis: 'belum_menikah', status: 'sudah diverifikasi', tanggal: '2025-01-06' },
            { id: 7, nama: 'Gilang Ramadhan', jenis: 'tidak_mampu', status: 'menunggu', tanggal: '2025-01-07' },
            { id: 8, nama: 'Hani Nurlaela', jenis: 'domisili', status: 'ditolak', tanggal: '2025-01-08' },
            { id: 9, nama: 'Indra Gunawan', jenis: 'ktp', status: 'diproses', tanggal: '2025-01-09' },
            { id: 10, nama: 'Joko Susilo', jenis: 'skck', status: 'sudah diverifikasi', tanggal: '2025-01-10' },
            { id: 11, nama: 'Kartini Sari', jenis: 'domisili', status: 'menunggu', tanggal: '2025-01-11' },
            { id: 12, nama: 'Lukman Hakim', jenis: 'kk', status: 'diproses', tanggal: '2025-01-12' },
            { id: 13, nama: 'Maya Sinta', jenis: 'belum_menikah', status: 'sudah diverifikasi', tanggal: '2025-01-13' },
            { id: 14, nama: 'Nanda Rizki', jenis: 'tidak_mampu', status: 'menunggu', tanggal: '2025-01-14' },
            { id: 15, nama: 'Omar Fadil', jenis: 'domisili', status: 'diproses', tanggal: '2025-01-15' }
        ];

        // Filter dan Pagination State
        let filteredData = [...sampleData];
        let currentPage = 1;
        let perPage = 10;
        let totalItems = sampleData.length;

        // DOM Elements
        const jenisFilter = document.getElementById('jenisFilter');
        const perPageSelect = document.getElementById('perPageSelect');
        const dataTable = document.getElementById('dataTable');
        const totalInfo = document.getElementById('totalInfo');
        const showingInfo = document.getElementById('showingInfo');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const pageNumbers = document.getElementById('pageNumbers');
        const testResults = document.getElementById('testResults');

        // Filter function
        function filterData(jenis = '') {
            logTest(`🔍 Filtering by jenis: "${jenis}"`);
            
            if (jenis === '') {
                filteredData = [...sampleData];
            } else {
                filteredData = sampleData.filter(item => item.jenis === jenis);
            }
            
            totalItems = filteredData.length;
            currentPage = 1; // Reset to first page
            
            logTest(`📊 Filtered results: ${totalItems} items`);
            
            updateDisplay();
        }

        // Pagination functions
        function updateDisplay() {
            updateTable();
            updatePagination();
            updateInfo();
        }

        function updateTable() {
            const startIndex = (currentPage - 1) * perPage;
            const endIndex = startIndex + perPage;
            const visibleData = filteredData.slice(startIndex, endIndex);
            
            logTest(`📄 Displaying page ${currentPage}: items ${startIndex + 1}-${Math.min(endIndex, totalItems)}`);
            
            dataTable.innerHTML = '';
            
            if (visibleData.length === 0) {
                dataTable.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center py-8 text-gray-500">
                            <i class="fas fa-inbox text-2xl mb-2 block"></i>
                            Tidak ada data
                        </td>
                    </tr>
                `;
                return;
            }
            
            visibleData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3">${startIndex + index + 1}</td>
                    <td class="px-4 py-3">${item.nama}</td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">
                            ${item.jenis.toUpperCase()}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs ${getStatusClass(item.status)}">
                            ${item.status}
                        </span>
                    </td>
                    <td class="px-4 py-3">${item.tanggal}</td>
                `;
                dataTable.appendChild(row);
            });
        }

        function updatePagination() {
            const totalPages = Math.ceil(totalItems / perPage);
            
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
            
            pageNumbers.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `px-3 py-1 border rounded text-sm ${
                    i === currentPage 
                        ? 'bg-blue-600 text-white border-blue-600' 
                        : 'hover:bg-gray-50 border-gray-300'
                }`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => goToPage(i);
                pageNumbers.appendChild(pageBtn);
            }
        }

        function updateInfo() {
            const startIndex = totalItems > 0 ? (currentPage - 1) * perPage + 1 : 0;
            const endIndex = Math.min(currentPage * perPage, totalItems);
            
            totalInfo.textContent = `Total: ${totalItems} item`;
            showingInfo.textContent = `Menampilkan ${startIndex} - ${endIndex} dari ${totalItems} hasil`;
        }

        function goToPage(page) {
            logTest(`📄 Navigating to page: ${page}`);
            currentPage = page;
            updateDisplay();
        }

        function getStatusClass(status) {
            switch (status) {
                case 'menunggu': return 'bg-yellow-100 text-yellow-800';
                case 'diproses': return 'bg-blue-100 text-blue-800';
                case 'sudah diverifikasi': return 'bg-green-100 text-green-800';
                case 'ditolak': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function logTest(message) {
            const testResult = document.createElement('div');
            testResult.className = 'text-green-600';
            testResult.innerHTML = `<i class="fas fa-check mr-2"></i>${message}`;
            testResults.appendChild(testResult);
            
            // Keep only last 10 test results
            if (testResults.children.length > 10) {
                testResults.removeChild(testResults.firstChild);
            }
        }

        // Event Listeners
        jenisFilter.addEventListener('change', function() {
            filterData(this.value);
        });

        perPageSelect.addEventListener('change', function() {
            perPage = parseInt(this.value);
            currentPage = 1;
            logTest(`📊 Changed per page to: ${perPage}`);
            updateDisplay();
        });

        prevBtn.addEventListener('click', function() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        });

        nextBtn.addEventListener('click', function() {
            const totalPages = Math.ceil(totalItems / perPage);
            if (currentPage < totalPages) {
                goToPage(currentPage + 1);
            }
        });

        // Initialize
        logTest('🚀 Test initialized with sample data');
        logTest(`📊 Sample data contains: ${sampleData.length} items`);
        filterData(); // Initialize display
        
        // Run automatic tests
        setTimeout(() => {
            logTest('🧪 Running automatic tests...');
            
            // Test filter
            jenisFilter.value = 'domisili';
            filterData('domisili');
            
            setTimeout(() => {
                // Test pagination
                if (Math.ceil(totalItems / perPage) > 1) {
                    goToPage(2);
                }
                
                setTimeout(() => {
                    // Test per page change
                    perPageSelect.value = '5';
                    perPage = 5;
                    currentPage = 1;
                    updateDisplay();
                    
                    setTimeout(() => {
                        // Reset to show all
                        jenisFilter.value = '';
                        filterData('');
                        logTest('✅ All tests completed successfully!');
                    }, 1000);
                }, 1000);
            }, 1000);
        }, 2000);
    </script>
</body>
</html>
